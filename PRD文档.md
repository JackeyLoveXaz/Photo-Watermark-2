# 图片水印工具产品需求文档

## 1. 产品概述

图片水印工具是一款用于批量添加文字或图片水印到图片文件的桌面应用程序。用户可以通过简单直观的界面，快速为多张图片添加自定义水印，并进行导出。

### 1.1 产品目标
- 提供简单直观的界面，让用户轻松添加文字和图片水印
- 支持批量处理多张图片，提高工作效率
- 提供丰富的水印自定义选项，包括位置、大小、透明度、旋转等
- 支持水印模板功能，方便用户重复使用常用的水印设置
- 保证导出图片的质量和原始图片的安全性

## 2. 系统架构

### 2.1 技术栈
- 开发语言：Java 17
- 界面框架：JavaFX 17.0.2
- 构建工具：Maven
- 图像处理：Java AWT、JavaFX Image API

### 2.2 目录结构
```
Photo-Watermark-2/
├── src/
│   ├── main/
│   │   ├── java/com/photowatermark/  # Java源代码
│   │   └── resources/fxml/           # FXML界面文件
├── pom.xml                           # Maven项目配置
├── run_app.bat                       # 运行脚本
├── README.md                         # 项目说明
├── LICENSE                           # 许可证文件
└── .gitignore                        # Git忽略文件配置
```

## 3. 功能需求

### 3.1 图片导入功能
- 支持通过文件选择器导入单张或多张图片
- 支持拖放方式导入图片
- 支持的图片格式：PNG、JPEG、GIF
- 显示导入图片的缩略图列表

### 3.2 水印设置功能

#### 3.2.1 文字水印设置
- 水印文本输入功能
- 字体选择（字体类型、粗细、大小）
- 颜色选择
- 透明度调整
- 旋转角度调整
- 文本样式设置（如斜体）

#### 3.2.2 图片水印设置
- 选择图片作为水印
- 调整水印图片大小（缩放比例）
- 调整水印透明度
- 调整水印旋转角度

### 3.3 水印位置设置
- 预设水印位置（居中、左上角、右上角、左下角、右下角）
- 自定义水印位置（通过拖动调整）
- 水印边距设置

### 3.4 水印模板功能
- 保存当前水印设置为模板
- 加载已保存的模板
- 管理模板（重命名、删除）

### 3.5 导出功能
- 选择导出目录
- 设置导出图片格式（PNG、JPEG）
- 设置导出图片质量
- 设置导出文件命名规则（前缀、后缀、是否保留原文件名）
- 批量导出图片
- 显示导出进度和结果

### 3.6 应用设置功能
- 保存和加载用户偏好设置
- 支持快捷键操作

## 4. 用户界面设计

### 4.1 主界面布局
- 顶部菜单栏：文件操作、编辑、帮助等
- 左侧图片列表：显示已导入图片的缩略图
- 中央预览区域：显示当前选中图片的水印效果预览
- 右侧控制面板：水印设置、导出设置、模板管理等选项卡

### 4.2 控制面板设计

#### 4.2.1 水印设置选项卡
- 水印类型选择（文字/图片）
- 文字水印设置区域
- 图片水印设置区域
- 水印位置选择器
- 水印透明度、旋转角度等参数滑块

#### 4.2.2 导出设置选项卡
- 输出目录选择
- 导出格式选择
- 导出质量设置
- 文件名设置（前缀、后缀、保留原文件名选项）

#### 4.2.3 模板管理选项卡
- 模板列表
- 保存/加载/删除模板按钮

## 5. 详细功能设计

### 5.1 图片导入流程
1. 用户通过文件选择器或拖放方式选择图片
2. 应用程序读取图片并生成缩略图
3. 缩略图显示在左侧图片列表中
4. 第一张导入的图片自动显示在预览区域

### 5.2 水印添加流程
1. 用户选择水印类型（文字或图片）
2. 根据选择的水印类型，显示相应的设置选项
3. 用户调整水印参数（文本内容、字体、颜色、大小、透明度、旋转角度等）
4. 实时预览水印效果
5. 用户可以拖动水印调整位置

### 5.3 图片导出流程
1. 用户选择导出目录
2. 设置导出参数（格式、质量、命名规则）
3. 点击导出按钮开始导出流程
4. 显示进度对话框
5. 导出完成后显示结果统计（成功/失败数量）

## 6. 类设计

### 6.1 Main类
- 应用程序入口点
- 加载主界面FXML文件
- 设置应用程序图标和标题
- 处理应用程序生命周期

### 6.2 MainController类
- 管理用户界面组件
- 处理用户交互事件
- 实现图片导入、水印添加、图片导出等核心功能
- 管理应用程序设置和模板

### 6.3 ImageItem类（内部类）
- 表示导入的图片项
- 包含原始文件引用和缩略图

## 7. 非功能性需求

### 7.1 性能要求
- 导入大图片时不应导致界面卡顿
- 批量处理多张图片时应显示进度并允许取消
- 水印添加操作应实时响应

### 7.2 兼容性要求
- 支持常见的图片格式（PNG、JPEG、GIF）
- 支持Windows操作系统

### 7.3 安全性要求
- 防止导出操作覆盖原始图片
- 处理文件操作异常，避免程序崩溃

### 7.4 用户体验要求
- 界面简洁直观
- 提供清晰的操作指引
- 实时预览水印效果
- 导出操作提供进度反馈

## 8. 安装和使用说明

### 8.1 系统要求
- JDK 17或更高版本
- 足够的磁盘空间用于存储图片文件

### 8.2 安装方法
1. 下载项目源代码
2. 使用Maven构建项目
3. 运行run_app.bat脚本启动应用程序

### 8.3 使用指南
1. 导入图片（通过文件选择器或拖放）
2. 选择水印类型并设置参数
3. 调整水印位置
4. 设置导出选项
5. 点击导出按钮保存带有水印的图片

## 9. 已知限制
- 不支持在导入图片上添加多个水印
- 不支持批量设置不同的水印到不同图片
- 处理超大图片时可能需要更多内存

## 10. 未来功能规划
- 支持多水印功能
- 支持水印图层管理
- 添加水印特效（如阴影、边框等）
- 增加批量处理规则设置
- 支持更多图片格式
- 支持批量调整图片大小和格式转换

## 11. 附录

### 11.1 快捷键列表
- Ctrl+O: 导入图片
- Ctrl+E: 导出图片
- Ctrl+S: 保存设置
- Ctrl+Q: 退出应用

### 11.2 常见问题解答
- 问题：为什么导出的图片比原始图片小？
  解答：导出图片质量设置可能较低，请在导出设置中调整质量参数。

- 问题：为什么不能将图片导出到原文件夹？
  解答：为防止意外覆盖原始图片，程序禁止导出到原图片所在文件夹，请选择其他输出目录。

- 问题：支持哪些图片格式？
  解答：目前支持PNG、JPEG和GIF格式的图片导入和处理。

- 问题：如何取消正在进行的导出操作？
  解答：在导出进度对话框中点击取消按钮，然后确认取消操作。